---
title: "Lat Model Work"
author: "Marlin"
date: "5/17/2021"
output: html_document
---

```{r}

library(ggpubr)
library(dplyr)
library(formula.tools)
source("../Scripts/GenPlotMaking.R")
source("../Scripts/WasteWaterDataProccess.R")
source("../Scripts/CassesDataProccess.R")
source("../Scripts/HelperFunctions.R")
LatWasteFN <- "../../UntrackedData/WW SARS-COV-2 Data V5.xlsx"
LatSpringCaseFN="../../UntrackedData/SpringSemester_CasesByDorm.tsv"
LatFallCaseFN="../../UntrackedData/Oct2020toEndFall_CasesByDorm.tsv"
CovidFileName = "../../UntrackedData/MMSD_Cases.csv"


```

```{r}

knitr::opts_chunk$set(echo = TRUE,fig.width = 15,fig.height = 15)

LatCaseDormsDF=CovidDataDorms(LatSpringCaseFN,LatFallCaseFN)%>%
  mutate(Per_pos=100*Cases/Tests)%>%
  select(-negitive_tests)



covidData=CovidData(CovidFileName)%>%
  mutate(Per_pos=100*Cases/Tests)%>%
  select(Date,Site,Cases,Tests,Per_pos)
LatCaseDF=rbind(covidData,LatCaseDormsDF)

Fullday=data.frame(Date=seq.Date(min(LatCaseDF$Date),max(LatCaseDF$Date),1))
LatCaseDF=full_join(LatCaseDF,Fullday,by=c("Date"))%>%
  arrange(Site,Date)%>%
  group_by(Site)%>%
  mutate(rollingPer_pos=RollPerPos(Cases,Tests))%>%
  ungroup()

LatWasteDF=WasteWater(LatWasteFN)%>%
  mutate(Date=as.Date(Date))%>%
  filter(!is.na(Date),!is.na(N1))%>%
  filter(Date<mdy("6/5/2021"))

MMSDData=full_join(LatWasteDF,LatCaseDF,by=c("Site","Date"))%>%
  filter(!is.na(Site),!is.na(Date))


LatWasteDF%>%
  mutate(Month=format(Date,"%B"))%>%
  ggplot()+geom_boxplot(aes(x=Month,y=N1),fill="light blue")+geom_point(aes(x=Month,y=mean(N1)),shape = 4)+facet_wrap(~Site)#+scale_y_log10()

```

```{r}
source("../Scripts/GenPlotMaking.R")
SiteOffsetMatrix(LatCaseDF,LatWasteDF,-14:14,"Site","Date","Cases~N1/PMMoV")

```