geom_jitter(width = .2)+
geom_smooth(method = "lm", se=FALSE)+
#geom_line(aes(y=Pred))+
facet_grid(Filter.Replicate~WWTP)
library(lmerTest)
#Replicate
#BCoV.percent.recovery Sig
#log(PMMoV.GC.L) Sig
#log(N1.GC.L) Not Sig
#log(N2.GC.L) Not Sig
MixedEffectModel <- lmer(log(N1.GC.L) ~ TimePassed + (1+TimePassed|WWTP:Filter.Replicate),
data = SigDecayDF)
summary(MixedEffectModel)
anova(MixedEffectModel)
anova(MixedEffectModel, test="F")
unique(LatCaseDF$Site)
DFLoessFNC(filter(LatCaseDF,Site=="MMSD-P8"))
unique(LIMSDF$Site)
DFLoessFNC(filter(LIMSFullDF,Site=="MMSD-P8"))
SmoothCasePlotDF(filter(LatCaseDF,Site=="MMSD-P8"))
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
MergedDF
LIMSMadDF <- DFLoessFNC(filter(LIMSFullDF,Site=="MMSD-P8"))
FullDayDF <- data.frame(Date=seq(min(LIMSMadDF$Date),max(LIMSMadDF$Date),1))
LIMSMadDF <- DFLoessFNC(filter(LIMSFullDF,Site=="MMSD-P8"))
LIMSMadDF
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(LIMSMadDF$Date),max(LIMSMadDF$Date),1))
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="Madison")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
MergedDF
ReadyDF
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P8")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
MergedDF
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P8")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(DFLoessFNC(LIMSMadDF)[-1])
loessPred <- ts(DFLoessFNC[-1])
DFLoessFNC
loessPred <- ts(LIMSMadDF[-1])
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(LIMSMadDF[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(80*rollmean(N1TSVec, 7,align="right",fill = NA)-800,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
80*loessPred-800,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-800,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-800,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-0,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-0,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)+100,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred+100,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)+100,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred+100,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)+50,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred+50,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)+0,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred+0,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-80,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-80,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(80*loessPred-800),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(10*loessPred-90),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
ConfigOption <- list(
myseed=1234567890,
XAxisLabSiz=10,
YAxisLabSiz=15,
GenFontSiz=20,
alphaPoint=.7,
PointSize=2,
alphaWeek=.2)
library(ggpubr)
library(dplyr)
library(forecast)
library(lmtest)
library(lubridate)
library(limma)
#Data Files and prep work
source("../../Scripts/GenPlotMaking.R")
source("../../Scripts/WasteWaterDataProccess.R")
source("../../Scripts/CassesDataProccess.R")
source("../../Scripts/HelperFunctions.R")
PathStarter="Z:/"
LatMMSDFN  <-  paste0(PathStarter,"COVID-19_WastewaterAnalysis/data/raw/MMSD_Cases.csv")
LIMSFN <- paste0(PathStarter,"COVID-19_WastewaterAnalysis/data/raw/WATERMICRO_WW_COVID-2021-06-30 17 40.xlsx")
#Z:\COVID-19_WastewaterAnalysis\data\raw
LatCaseDF <- CovidDataPARSER(MMSDFN = LatMMSDFN)%>%
filter(!is.na(Site))%>%
select(Date,Site,Cases,Tests,Per_pos)
LatCaseMadDF <- LatCaseDF%>%
filter(Site == "Madison")
LIMSFullDF <- LIMSDataPARSER(LIMSFN)%>%
select(Date,Site, BCoV, N1,N1Error,N2, N2Error,PMMoV,Pop,FlowRate)
LIMSMadDF <- LIMSFullDF%>%
filter(Site == "Madison")
#return( RollPerPos(CaseDF,"Cases","Tests",Facet="Site"))
library(limma)
DFSmoothingFNC <- function(CaseDF){
#5.028338
scale =5.028338
#2.332779
shape =2.332779
FullDayDF <- data.frame(Date=seq(min(CaseDF$Date),max(CaseDF$Date),1))
FullDateDF <- full_join(FullDayDF,CaseDF, by = c("Date"))%>%
fill(Cases, .direction = "down")%>%
group_by(Site)%>%
mutate(Cases2 = c(rep(NA,20),
rollapply(Cases,width=21,FUN=weighted.mean,
w=dgamma(1:21,scale =scale,shape =shape),
na.rm = TRUE)))
}
DFLoessFNC <- function(LimsDF){
FullDayDF <- data.frame(Date=seq(min(LimsDF$Date),max(LimsDF$Date),1))
ReadyDF <- full_join(FullDayDF,LimsDF, by = c("Date"))%>%
fill(N1, .direction = "down")
loessFit(y=log(ReadyDF$N1),
x=ReadyDF$Date,
span=.125,
min.weight=0,
max.weight=1e5,
iterations=10)$fitted
}
SmoothCasePlotDF <- DFSmoothingFNC(LatCaseMadDF)
#5.028338
scale =5.028338
#2.332779
shape =2.332779
plot(dgamma(1:30,scale =scale,shape =shape))
FullDayDF <- data.frame(Date=seq(min(LIMSMadDF$Date),max(LIMSMadDF$Date),1))
ReadyDF <- full_join(FullDayDF,LIMSMadDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="Madison")
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(DFLoessFNC(LIMSMadDF)[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(80*rollmean(N1TSVec, 7,align="right",fill = NA)-800,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
80*loessPred-800,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
#library(smooth)
#sma(MergedDF[,8], h=7)
# fit = Arima(CasesTSVec, xreg=loessPred, order=c(2,1,0))
#
# cbind("Regression Errors" = residuals(fit, type="regression"),
#       "ARIMA errors" = residuals(fit, type="innovation")) %>%
#   autoplot(facets=TRUE)
# checkresiduals(fit)
#
ts.plot(diff(CasesTSVec),
diff(80*loessPred-800),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
IndependentVec <- diff(loessPred)
DependentVec <- diff(CasesTSVec)
ccfvalues2  <-  ccf(IndependentVec,DependentVec,type = c("correlation"),na.action = na.pass)
ccfvalues2  <-  ccf(loessPred,CasesTSVec,type = c("correlation"),na.action = na.pass)
alldata1 <- ts.union(Pred = diff(CasesTSVec),N1Norm = diff(loessPred),
N1TSVec,
N1A=stats::lag(diff(loessPred),1),
N1B=stats::lag(diff(loessPred),10),
N1C=stats::lag(diff(loessPred)))
tryit1a  <- lm(Pred~N1B, data = alldata1)
summary(tryit1a)
#plot(tryit1a)
acf(residuals(tryit1a))
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P8")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(LIMSMadDF[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(10*loessPred-90),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
CasePlot <- ggplot()+
geom_rect(aes(xmin=Date-.5,xmax=Date+.5,ymin=0,ymax=Cases),color="dark gray",fill="gray", data=LatCaseMadDF)+
geom_line(aes(x=Date,y=Cases2),data=SmoothCasePlotDF,color="red")+
coord_cartesian(xlim = c(min(LIMSMadDF$Date),max(LIMSMadDF$Date)))+
xlab("")+
theme(axis.title.y = element_text(size=12))
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P8")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(LIMSMadDF[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(10*loessPred-90),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
CasePlot <- ggplot()+
geom_rect(aes(xmin=Date-.5,xmax=Date+.5,ymin=0,ymax=Cases),color="dark gray",fill="gray", data=LatCaseMadDF)+
geom_line(aes(x=Date,y=Cases2),data=SmoothCasePlotDF,color="red")+
coord_cartesian(xlim = c(min(LIMSMadDF$Date),max(LIMSMadDF$Date)))+
xlab("")+
theme(axis.title.y = element_text(size=12))
CasePlot <- ggplot()+
geom_rect(aes(xmin=Date-.5,xmax=Date+.5,ymin=0,ymax=Cases),color="dark gray",fill="gray", data=LatCaseMadDF)+
geom_line(aes(x=Date,y=Cases2),data=SmoothCasePlotDF,color="red")+
coord_cartesian(xlim = c(min(LIMSMadDF$Date),max(LIMSMadDF$Date)))+
xlab("")+
theme(axis.title.y = element_text(size=12))
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
ConfigOption <- list(
myseed=1234567890,
XAxisLabSiz=10,
YAxisLabSiz=15,
GenFontSiz=20,
alphaPoint=.7,
PointSize=2,
alphaWeek=.2)
library(ggpubr)
library(dplyr)
library(forecast)
library(lmtest)
library(lubridate)
library(limma)
#Data Files and prep work
source("../../Scripts/GenPlotMaking.R")
source("../../Scripts/WasteWaterDataProccess.R")
source("../../Scripts/CassesDataProccess.R")
source("../../Scripts/HelperFunctions.R")
PathStarter="Z:/"
LatMMSDFN  <-  paste0(PathStarter,"COVID-19_WastewaterAnalysis/data/raw/MMSD_Cases.csv")
LIMSFN <- paste0(PathStarter,"COVID-19_WastewaterAnalysis/data/raw/WATERMICRO_WW_COVID-2021-06-30 17 40.xlsx")
#Z:\COVID-19_WastewaterAnalysis\data\raw
LatCaseDF <- CovidDataPARSER(MMSDFN = LatMMSDFN)%>%
filter(!is.na(Site))%>%
select(Date,Site,Cases,Tests,Per_pos)
LatCaseMadDF <- LatCaseDF%>%
filter(Site == "Madison")
LIMSFullDF <- LIMSDataPARSER(LIMSFN)%>%
select(Date,Site, BCoV, N1,N1Error,N2, N2Error,PMMoV,Pop,FlowRate)
LIMSMadDF <- LIMSFullDF%>%
filter(Site == "Madison")
#return( RollPerPos(CaseDF,"Cases","Tests",Facet="Site"))
library(limma)
DFSmoothingFNC <- function(CaseDF){
#5.028338
scale =5.028338
#2.332779
shape =2.332779
FullDayDF <- data.frame(Date=seq(min(CaseDF$Date),max(CaseDF$Date),1))
FullDateDF <- full_join(FullDayDF,CaseDF, by = c("Date"))%>%
fill(Cases, .direction = "down")%>%
group_by(Site)%>%
mutate(Cases2 = c(rep(NA,20),
rollapply(Cases,width=21,FUN=weighted.mean,
w=dgamma(1:21,scale =scale,shape =shape),
na.rm = TRUE)))
}
DFLoessFNC <- function(LimsDF){
FullDayDF <- data.frame(Date=seq(min(LimsDF$Date),max(LimsDF$Date),1))
ReadyDF <- full_join(FullDayDF,LimsDF, by = c("Date"))%>%
fill(N1, .direction = "down")
loessFit(y=log(ReadyDF$N1),
x=ReadyDF$Date,
span=.125,
min.weight=0,
max.weight=1e5,
iterations=10)$fitted
}
SmoothCasePlotDF <- DFSmoothingFNC(LatCaseMadDF)
#5.028338
scale =5.028338
#2.332779
shape =2.332779
plot(dgamma(1:30,scale =scale,shape =shape))
FullDayDF <- data.frame(Date=seq(min(LIMSMadDF$Date),max(LIMSMadDF$Date),1))
ReadyDF <- full_join(FullDayDF,LIMSMadDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="Madison")
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(DFLoessFNC(LIMSMadDF)[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(80*rollmean(N1TSVec, 7,align="right",fill = NA)-800,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
80*loessPred-800,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
#library(smooth)
#sma(MergedDF[,8], h=7)
# fit = Arima(CasesTSVec, xreg=loessPred, order=c(2,1,0))
#
# cbind("Regression Errors" = residuals(fit, type="regression"),
#       "ARIMA errors" = residuals(fit, type="innovation")) %>%
#   autoplot(facets=TRUE)
# checkresiduals(fit)
#
ts.plot(diff(CasesTSVec),
diff(80*loessPred-800),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
IndependentVec <- diff(loessPred)
DependentVec <- diff(CasesTSVec)
ccfvalues2  <-  ccf(IndependentVec,DependentVec,type = c("correlation"),na.action = na.pass)
ccfvalues2  <-  ccf(loessPred,CasesTSVec,type = c("correlation"),na.action = na.pass)
alldata1 <- ts.union(Pred = diff(CasesTSVec),N1Norm = diff(loessPred),
N1TSVec,
N1A=stats::lag(diff(loessPred),1),
N1B=stats::lag(diff(loessPred),10),
N1C=stats::lag(diff(loessPred)))
tryit1a  <- lm(Pred~N1B, data = alldata1)
summary(tryit1a)
#plot(tryit1a)
acf(residuals(tryit1a))
TempDF <- filter(LIMSFullDF,Site=="MMSD-P8")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P8")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(LIMSMadDF[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(10*loessPred-90),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
CasePlot <- ggplot()+
geom_rect(aes(xmin=Date-.5,xmax=Date+.5,ymin=0,ymax=Cases),color="dark gray",fill="gray", data=LatCaseMadDF)+
geom_line(aes(x=Date,y=Cases2),data=SmoothCasePlotDF,color="red")+
coord_cartesian(xlim = c(min(LIMSMadDF$Date),max(LIMSMadDF$Date)))+
xlab("")+
theme(axis.title.y = element_text(size=12))
TempDF <- filter(LIMSFullDF,Site=="MMSD-P2")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P2")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P8"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
LatCaseDF
TempDF <- filter(LIMSFullDF,Site=="MMSD-P7")
LIMSMadDF <- DFLoessFNC(TempDF)
FullDayDF <- data.frame(Date=seq(min(TempDF$Date),max(TempDF$Date),1))
ReadyDF <- full_join(FullDayDF,TempDF, by = c("Date"))%>%
fill(N1, .direction = "down")%>%
mutate(Site="MMSD-P7")
SmoothCasePlotDF <- DFSmoothingFNC(filter(LatCaseDF,Site=="MMSD-P7"))
MergedDF <- inner_join(SmoothCasePlotDF,ReadyDF, by=c("Date","Site"))
CasesTSVec <- ts(MergedDF)[,6]
CasesTSVec2 <- ts(MergedDF)[,3]
loessPred <- ts(LIMSMadDF[-1])
N1TSVec <- log(ts(MergedDF)[,8])
ts.plot(10*rollmean(N1TSVec, 7,align="right",fill = NA)-90,
rollmean(CasesTSVec2, 7,align="right",fill = NA),
CasesTSVec,
10*loessPred-90,
col=c( "light blue","pink","red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","7 MA Cases","Loess Smoothing","7 MA N1"), col=c("red","pink","blue", "light blue"), lty=1, cex=1)
ts.plot(diff(CasesTSVec),
diff(10*loessPred-90),
col=c("red","blue"),
gpars=list(xlab="Time (Days)", ylab="Cases"))
legend("topright", legend=c("SLD Cases","Loess Smoothing"), col=c("red","blue"), lty=1, cex=1)
#Do for non interceptor data
#Transformation to stabilize scale
#1)Make overlay plot function
#a)normal comp
#b)first difference
#c)P8 version
#compare smooth vs Smooth  ccf
#show all smooth Unsmooth combos
#look for best gamma
#CCF
#broke it into 2 parts
#CCF of SLD vs raw N1
#ccf(CasesTSVec,)
MixedEffectModel <- lmer(log(N1.GC.L) ~ TimePassed + (1+TimePassed|WWTP:Filter.Replicate),
data = SigDecayDF)
summary(MixedEffectModel)
setwd("C:/Users/Marlin/Desktop/COVID-19_WastewaterAnalysis/COVID-19_WastewaterAnalysis/Code-Notebooks")
setwd("C:/Users/Marlin/Desktop/COVID-19_WastewaterAnalysis/COVID-19_WastewaterAnalysis")
setwd("C:/Users/Marlin/Desktop/COVID-19_WastewaterAnalysis/COVID-19_WastewaterAnalysis/Code-Notebooks")
