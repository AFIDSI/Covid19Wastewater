#   MainDF=RelWasteData,
#   #LineDF =meanOfN1,
#   Loc="Site",
#   YLabel = "N1 (GC/L)",
#   log_scale=T,
#   ColorType="Filter replicates",
#   DateLimits=Date_lim_HFG,
#   RMOutliers=T,
#   AxisPos="bottom",
#   Standards=ConfigOption,
#   Xfreq="14 days",
#   boxingDF=meanOfN1,
#   nrow=2)+ Header_theme(ConfigOption)+
#       theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
#             plot.margin = unit(c(.5,0,0,0), "cm"))
#N1PlotGraphic+geom_rect(aes(ymin=lower,ymax=Upper,xmin=Date-.3,xmax=Date+.3),fill="red",alpha=.6,data=meanOfN1)
```
LatData=LatWasteDF%>%
filter((Site=="Madison"))
HFGData=HFGFrame%>%
filter((Site=="Madison"))
#??lat data off shifted by one day??
#*change legend labels
ggplot()+geom_point(aes(y=N1,color=`Filter replicates`,x=Date,shape="High Frequency"),data=HFGData)+
geom_point(aes(y=N1,x=Date-1,shape="Longitudinal"),data=LatData,size=2.5)+
ylab("N1 (GC/L)")+
scale_y_log10()+
labs(shape="Data Set")+
scale_x_date(limits=c(N1Start,N1End))+ggtitle("HFG and Longitudinal data match")
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
filter(N1<2e6)%>%
mutate(`Percent BCoV Recovery`=ifelse(Pct_BCoV<.5,"Low","Medium"))%>%
mutate(`Percent BCoV Recovery`=ifelse(Pct_BCoV>10,"High",`Percent BCoV Recovery`))%>%
ggplot()+aes(x=Pct_BCoV,y=N1,color=`Percent BCoV Recovery`)+geom_point()+
xlab("%Bcov Recovery")+
ylab("N1 (GC/L)")+
#scale_y_log10()+
#scale_x_log10()+
facet_wrap(~Site)+
ggtitle("N1 Vs %Bcov recovery")
#, scales = "free"
#scale_x_log10()+,color=marked
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
mutate(Per_Bcov_Recovery=ifelse(Pct_BCoV<.5,"Low","Medium"))%>%
mutate(Per_Bcov_Recovery=ifelse(Pct_BCoV>10,"High",Per_Bcov_Recovery))%>%
ggplot()+aes(x=Date,y=N1,color=Per_Bcov_Recovery)+geom_point()+
ggtitle("Percent BCoV recovery and N1 appear unrelated")+
scale_y_log10()+facet_wrap(~Site)
#meam=data.frame(a=1:1000)
#meam$b=30*runif(1000)-15
#meam%>%
#  mutate(noiscor=a+b)%>%
#  ggplot()+geom_point(aes(x=a,y=noiscor))+
#  scale_y_log10()+
#  scale_x_log10()
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
filter(N1<2e6)%>%
mutate(`Percent BCoV Recovery`=ifelse(Pct_BCoV<.5,"Low","Medium"))%>%
mutate(`Percent BCoV Recovery`=ifelse(Pct_BCoV>10,"High",`Percent BCoV Recovery`))%>%
ggplot()+aes(x=Pct_BCoV,y=N1,color=`Percent BCoV Recovery`)+geom_point()+
xlab("Percent Bcov Recovery")+
ylab("N1 (GC/L)")+
#scale_y_log10()+
#scale_x_log10()+
facet_wrap(~Site)+
ggtitle("N1 Vs %Bcov recovery")
#, scales = "free"
#scale_x_log10()+,color=marked
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
mutate(Per_Bcov_Recovery=ifelse(Pct_BCoV<.5,"Low","Medium"))%>%
mutate(Per_Bcov_Recovery=ifelse(Pct_BCoV>10,"High",Per_Bcov_Recovery))%>%
ggplot()+aes(x=Date,y=N1,color=Per_Bcov_Recovery)+geom_point()+
ggtitle("Percent BCoV recovery and N1 appear unrelated")+
scale_y_log10()+facet_wrap(~Site)
#meam=data.frame(a=1:1000)
#meam$b=30*runif(1000)-15
#meam%>%
#  mutate(noiscor=a+b)%>%
#  ggplot()+geom_point(aes(x=a,y=noiscor))+
#  scale_y_log10()+
#  scale_x_log10()
NovemberBreak=seq(from=mdy("12/18/2020"),to=mdy("1/25/2021"),by=1)
shift=-0
LeftDate=min(LatWasteDF$Date)
RightDate=max(LatWasteDF$Date)
p1=LatWasteDF%>%
filter((Site=="UW-Sellery")|(Site=="UW-LakeShore"))%>%
filter(!(Date %in% NovemberBreak))%>%
mutate(Loc="10")%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("1/25/2021"),"4",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("12/18/2020"),"3",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("11/18/2020"),"2",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("10/18/2020"),"1",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("2/5/2021"),"5",Loc))%>%
#mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("12/18/2020"),"4",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("12/18/2020"),"3",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("11/4/2020"),"2",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("10/11/2020"),"1",Loc))%>%
ggplot()+
geom_boxplot(aes(y=N1,x=Date,group=Loc),fill="light blue")+
geom_point(aes(y=N1,x=Date,color=Loc),fill="light blue")+
scale_y_log10()+
facet_wrap(~Site)+
ylab("N1 (GC/L)")+
scale_x_date(limits=c(LeftDate,RightDate))+ Header_theme(ConfigOption)
RelCaseLongDF=LatCaseDF%>%
filter((Site=="UW-Sellery")|(Site=="UW-LakeShore"))
RelCaseLongRollDF= LatCaseDFRoll%>%
filter((Site=="UW-Sellery")|(Site=="UW-LakeShore"))
Date_lim_long=c(min(RelCaseLongDF$Date),max(RelCaseLongDF$Date))
p2=Buildplot_gen(
"Cases",
MainDF=RelCaseLongDF,
Loc="Site",
LineDF=RelCaseLongRollDF,
DateLimits=Date_lim_long+shift,
Standards=ConfigOption,
AxisPos="bottom",
LineColor="red",
Colplot=F,scalesF="free_y")+
theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
plot.margin = unit(c(.5,0,0,0), "cm"))
annotate_figure(top=text_grob("Dorm data with ad hoc binning",size=15),ggarrange(p1,p2,nrow = 2,align="hv"))
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
library(shiny)
library(ggpubr)
library(dplyr)
library(shinydashboard)
library(shinyjqui)
library(shinycssloaders)
#Data Files and prepwork
source("../Scripts/GenPlotMaking.R")
source("../Scripts/WasteWaterDataProccess.R")
source("../Scripts/CassesDataProccess.R")
source("../Scripts/HelperFunctions.R")
LatWasteFN <- "../../UntrackedData/WW SARS-COV-2 Data V5.xlsx"
LatSpringCaseFN="../../UntrackedData/SpringSemester_CasesByDorm.tsv"
LatFallCaseFN="../../UntrackedData/FallSemester_CasesByDorm.tsv"
HFGWasteFN = "../../UntrackedData/HFG data for stats preliminary 3-18-21.xlsx"
HFGCaseFN="../../UntrackedData/HighFreq_CaseData_2021-05-07.csv"
LatMMSDFN = "../../UntrackedData/MMSD_Cases.2021-05-21.csv"
HFGFrame=HFGInfo(HFGWasteFN)%>%
select(Date,Site=Plant,Filter,Well,N1=N1GC,N2=N2GC,PMMoV=PMMOVGC,Pct_BCoV=BCoV)%>%
mutate(Filter=as.character(Filter),Well=as.character(Well))%>%
rename(`Filter replicates`=Filter)
HFGCaseDF=HFGCasesPARSER(HFGCaseFN)
HFGCaseDFRoll=HFGCaseDF%>%
mutate(EpisodeCases=ifelse(EpisodeCases==-999,2.5,EpisodeCases))%>%
mutate(CollectedCases=ifelse(CollectedCases==-999,2.5,CollectedCases))%>%
mutate(ConfirmedCases=ifelse(ConfirmedCases==-999,2.5,ConfirmedCases))%>%
RollAvg(Facet="Site")%>%
select(Date,Site,ends_with("Cases"))
HFGPop=read.csv("../../UntrackedData/HFGPop.csv.txt")%>%
select(Site=wwtp_name,Population=pop_served)
HFGCaseDF=full_join(HFGPop,HFGCaseDF,by="Site")
HFGCaseDFRoll=full_join(HFGPop,HFGCaseDFRoll,by="Site")
HFGDateRangeDF=WeekendGen(HFGCaseDF$Date)
LatCaseDF=CovidDataPARSER(LatSpringCaseFN,LatFallCaseFN,LatMMSDFN)%>%
filter(!is.na(Site))%>%
select(Date,Site,Cases,Tests,Per_pos)
#return(LatCaseDF)
LatCaseDFRoll=RollPerPos(LatCaseDF,"Cases","Tests",Facet="Site")%>%
select(Date,Site,Cases,Per_pos)
LatWasteDF=WasteWater(LatWasteFN)%>%
mutate(Date=as.Date(Date))%>%
filter(!is.na(Date),!is.na(N1),!is.na(Site))%>%
filter(Date<mdy("6/5/2021"))%>%
select(Date,Site,N1,N2,PMMoV,Pct_BCoV,AVG)
ConfigOption=list(
myseed=1234567890,
XAxisLabSiz=10,
YAxisLabSiz=15,
GenFontSiz=20,
alphaPoint=.7,
PointSize=2,
alphaWeek=.2)
N1Start=min(HFGFrame$Date)
N1End=max(HFGFrame$Date)
CStart=min(HFGCaseDF$Date)
CEnd=max(HFGCaseDF$Date)
SiteOptions=c("Hudson","Kenosha","Platteville","Madison", "Merrill","Plymouth","River Falls","Sun Prairie","Wausau","Oshkosh")
HFGCaseDFRoll%>%
ggplot()+aes(x=Date)+geom_point(aes(y=ConfirmedCases,x=Date-2))+
scale_x_date(limits=c(N1Start,N1End))+
facet_wrap(~Site,scales = "free")+ggtitle("Sparse HFG Case Data")
SiteOptions2=c("Kenosha","Madison", "Sun Prairie","Wausau","Oshkosh")
HFGFrame%>%
filter(!is.na(N1),Site %in% SiteOptions2)%>%
group_by(Site)%>%
summarize(`N1 testing Range`=max(Date)-min(Date),NDays=length(unique(Date)))
SiteOptions2=c("Kenosha","Madison", "Sun Prairie","Wausau")
MaskedDataRange="1-4 Cases"
RelData=HFGCaseDF%>%
filter(Site %in% SiteOptions2)%>%
mutate(Small3=ifelse(EpisodeCases==-999,MaskedDataRange,"Normal Values"))%>%
mutate(PHI_masking=ifelse(CollectedCases==-999,MaskedDataRange,"Reported values"))%>%
mutate(Small2=ifelse(ConfirmedCases==-999,MaskedDataRange,"Normal Values"))%>%
filter(!is.na(PHI_masking))%>%
mutate(EpisodeCases=ifelse(EpisodeCases==-999,2.5,EpisodeCases))%>%
mutate(CollectedCases=ifelse(CollectedCases==-999,2.5,CollectedCases))%>%
mutate(ConfirmedCases=ifelse(ConfirmedCases==-999,2.5,ConfirmedCases))
RelRollData=HFGCaseDFRoll%>%
filter(Site %in% SiteOptions2)
RelWasteData=HFGFrame%>%
filter(!is.na(Site))%>%
filter(Site %in% SiteOptions2)
Data_mean_var = reactive({
HFGSiteMean=filtered_data_P()%>%
group_by(Date,Site)%>%
summarise(N1=exp(mean(log(N1),na.rm = T)),
N2=exp(mean(log(N2),na.rm = T)),
PMMoV=exp(mean(log(PMMoV),na.rm = T)),
Pct_BCoV=exp(mean(log(Pct_BCoV),na.rm = T)))
})
#Data of the means of each Filter
Filter_mean_var = reactive({
HFGFilterMean=filtered_data_P()%>%
group_by(Date,Site,`Filter replicates`)%>%
summarise(N1=exp(mean(log(N1),na.rm = T)),
N2=exp(mean(log(N2),na.rm = T)),
PMMoV=exp(mean(log(PMMoV),na.rm = T)),
Pct_BCoV=exp(mean(log(Pct_BCoV),na.rm = T)))
})
source("../Scripts/GenPlotMaking.R")
#c(N1Start,N1End)
Date_lim_HFG=c(min(RelData$Date)-2,max(RelData$Date)+2)
HFDCasesGraphic=Buildplot_gen("CollectedCases",
MainDF=RelData,
ColorType="PHI_masking",
Loc="Site",
LineDF=RelRollData,
WeekDF=HFGDateRangeDF,
DateLimits=Date_lim_HFG,
Standards=ConfigOption,
Xfreq="14 days",
AxisPos="bottom",
LineColor="red",
norm="Population",
Colplot=T,
Start=N1Start,
End=N1End,
nrow=2)+ Header_theme(ConfigOption)+
theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
plot.margin = unit(c(.5,0,0,0), "cm"))
#ordered factor
#arrow point to lines
#label span of hf collection
#arrow at bottom
#add text box to explain lines
scopeText=geom_text(aes(label = "Range of HF collection"))
HFDCasesGraphic+ annotate("text", x = N1Start+11.5, y = max(RelData$CollectedCases/RelData$Population), label = "<-  Range of HF collection  ->")
#add arrows
meanOfN1=HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
group_by(Site,Date)%>%
summarise(N1=exp(mean(log(N1),na.rm=T)))%>%
select(Date,Site,N1)%>%
mutate(lower=N1-2*0.2199*N1)%>%
mutate(Upper=N1+2*0.2199*N1)
N1PlotGraphic=Buildplot_gen(
"N1",
MainDF=RelWasteData,
LineDF =meanOfN1,
Loc="Site",
YLabel = "N1 (GC/L)",
log_scale=T,
ColorType="Filter replicates",
DateLimits=Date_lim_HFG,
RMOutliers=T,
AxisPos="bottom",
Standards=ConfigOption,
Xfreq="14 days",
nrow=2)+ Header_theme(ConfigOption)+
theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
plot.margin = unit(c(.5,0,0,0), "cm"))
N1PlotGraphic
#EpisodeCases    ConfirmedCases CollectedCases
#annotate_figure(top=text_grob("No clear pattern partially due to short time frame",size=15),ggarrange(p1,p2,nrow = 2,align="hv",common.legend = T))
#yaxis needs units=
#N1 (GC/L)
#Varience analysis
HFGFrame%>%
select(Date,Site,`Filter replicates`,N1)%>%
group_by(Site,Date)%>%
summarize(mN1=exp(mean(log(N1))),vN1=var(N1))%>%
ggplot()+geom_point(aes(x=mN1,y=sqrt(vN1),color=Site))+
scale_y_log10()+scale_x_log10()+ylab("SD")+xlab("Daily geometric mean of N1")+
ggtitle("Measurement error scales linearly")
# Buildplot_gen(
#   "N1",
#   MainDF=RelWasteData,
#   #LineDF =meanOfN1,
#   Loc="Site",
#   YLabel = "N1 (GC/L)",
#   log_scale=T,
#   ColorType="Filter replicates",
#   DateLimits=Date_lim_HFG,
#   RMOutliers=T,
#   AxisPos="bottom",
#   Standards=ConfigOption,
#   Xfreq="14 days",
#   boxingDF=meanOfN1,
#   nrow=2)+ Header_theme(ConfigOption)+
#       theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
#             plot.margin = unit(c(.5,0,0,0), "cm"))
#N1PlotGraphic+geom_rect(aes(ymin=lower,ymax=Upper,xmin=Date-.3,xmax=Date+.3),fill="red",alpha=.6,data=meanOfN1)
```
#fix order to low medium high
#add x axis label
#PMMoV (GC/L)
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
mutate(`PMMoV Level`=ifelse(PMMoV<1*10^7,"Low","Medium"))%>%
mutate(`PMMoV Level`=ifelse(PMMoV>1*10^8,"High",`PMMoV Level`))%>%
ggplot()+aes(x=PMMoV,y=N1,color=`PMMoV Level`)+geom_point()+scale_y_log10()+
scale_x_log10()+facet_wrap(~Site)+ggtitle("N1 Vs PMMoV")+ Header_theme(ConfigOption)+
xlab("PMMoV (GC/L)")+ylab("N1 (GC/L)")+
theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
plot.margin = unit(c(.5,0,0,0), "cm"))
HFGFrame%>%
filter(Site %in% SiteOptions2)%>%
mutate(`PMMoV Level`=ifelse(PMMoV<1*10^7,"Low","Medium"))%>%
mutate(`PMMoV Level`=ifelse(PMMoV>1*10^8,"High",`PMMoV Level`))%>%
ggplot()+aes(x=Date,y=N1,color=`PMMoV Level`)+ Header_theme(ConfigOption)+geom_point()+
ylab("N1 (GC/L)")+ggtitle("PMMoV and N1 appear unrelated")+
scale_y_log10()+facet_wrap(~Site)+
theme(axis.text.x = element_text(size = ConfigOption$XAxisLabSiz, colour = "black"),
plot.margin = unit(c(.5,0,0,0), "cm"))
knitr::opts_chunk$set(
echo = FALSE,
message = FALSE,
warning = FALSE
)
library(shiny)
library(ggpubr)
library(dplyr)
library(shinydashboard)
library(shinyjqui)
library(shinycssloaders)
#Data Files and prepwork
source("../Scripts/GenPlotMaking.R")
source("../Scripts/WasteWaterDataProccess.R")
source("../Scripts/CassesDataProccess.R")
source("../Scripts/HelperFunctions.R")
LatWasteFN <- "../../UntrackedData/WW SARS-COV-2 Data V5.xlsx"
LatSpringCaseFN="../../UntrackedData/SpringSemester_CasesByDorm.tsv"
LatFallCaseFN="../../UntrackedData/FallSemester_CasesByDorm.tsv"
HFGWasteFN = "../../UntrackedData/HFG data for stats preliminary 3-18-21.xlsx"
HFGCaseFN="../../UntrackedData/HighFreq_CaseData_2021-05-07.csv"
LatMMSDFN = "../../UntrackedData/MMSD_Cases.2021-05-21.csv"
HFGFrame=HFGInfo(HFGWasteFN)%>%
select(Date,Site=Plant,Filter,Well,N1=N1GC,N2=N2GC,PMMoV=PMMOVGC,Pct_BCoV=BCoV,everything())%>%
mutate(Filter=as.character(Filter),Well=as.character(Well))%>%
na.omit()
HFGCaseDF=HFGCasesPARSER(HFGCaseFN)
Fullday=data.frame(Date=seq.Date(min(HFGCaseDF$Date),max(HFGCaseDF$Date),1))
HFGCaseDF=full_join(HFGCaseDF,Fullday,by=c("Date"))
# HFGCaseDF2=HFGCaseDF%>%
#       mutate(isna=ifelse(EpisodeCases==-999,"True","false"))%>%
#       mutate(EpisodeCases=ifelse(EpisodeCases==-999,NA,EpisodeCases))%>%
#       mutate(CollectedCases=ifelse(CollectedCases==-999,NA,CollectedCases))%>%
#       mutate(ConfirmedCases=ifelse(ConfirmedCases==-999,NA,ConfirmedCases))
#
# HFGCaseDFroll2=HFGCaseDF2%>%
#       filter(!is.na(Site))%>%
#       arrange(Site,Date)%>%
#       group_by(Site)%>%
#       mutate(CollectedCases2=RollAvg(CollectedCases),EpisodeCases2=RollAvg(EpisodeCases),ConfirmedCases2=RollAvg(ConfirmedCases))%>%
#       ungroup()
LatCaseDF=CovidDataPARSER(LatSpringCaseFN,LatFallCaseFN,LatMMSDFN)
LatWasteDF=WasteWater(LatWasteFN)%>%
mutate(Date=as.Date(Date))%>%
filter(!is.na(Date),!is.na(N1),!is.na(Site))%>%
filter(Date<mdy("6/5/2021"))%>%
select(Date,Site,N1,N2,PMMoV,Pct_BCoV,AVG)
HFGFrame%>%
select(Date,Site,Filter,N1)%>%
group_by(Site,Date)%>%
summarize(mN1=exp(mean(log(N1))),vN1=var(N1))%>%
ggplot()+geom_point(aes(x=mN1,y=sqrt(vN1),color=Site))+
scale_y_log10()+scale_x_log10()+ggtitle("Mean vs Standard deviation of 9 points")
HFGVarNine=HFGFrame%>%
select(Date,Site,Filter,N1)%>%
group_by(Site,Date)%>%
summarize(mN1=mean(N1),vN1=var(N1))
cor(HFGVarNine$mN1,sqrt(HFGVarNine$vN1))
HFGFrame%>%
select(Date,Site,Filter,N1)%>%
group_by(Site,Date,Filter)%>%
summarize(mN1=mean(N1),vN1=var(N1))%>%
ggplot()+geom_point(aes(x=mN1,y=sqrt(vN1),color=Site))+
scale_y_log10()+scale_x_log10()+ggtitle("Mean vs Standard deviation of 3 points")
HFGVarThree=HFGFrame%>%
select(Date,Site,Filter,N1)%>%
group_by(Site,Date,Filter)%>%
summarize(mN1=mean(N1),vN1=var(N1))
cor(HFGVarThree$mN1,sqrt(HFGVarThree$vN1),use="pairwise.complete.obs")
cor(HFGVarThree$mN1,HFGVarThree$vN1,use="pairwise.complete.obs")
# cases
# LM
# SD
# mean line
# collection, analysis
#
#
T=8
HFGVar=HFGFrame%>%
select(Date,Site,N1)%>%
filter(N1<10e7)%>%
group_by(Site,Date)%>%
summarize(mN1=mean(N1),vN1=var(N1))
LM=lm(data=HFGVar,sqrt(vN1)~mN1-1)
LM
# HFGFrame%>%
#   select(Date,Site,N1,Filter)%>%
#   mutate(lower=N1-1.860*sqrt(207167*N1)/sqrt(9))%>%
#   mutate(Upper=N1+1.860*sqrt(207167*N1)/sqrt(9))%>%
#   #mutate(contzero=lower<0&Upper>0)
#   ggplot()+
#   geom_rect(aes(fill=Filter,ymin=lower,ymax=Upper,xmin=Date-.3,xmax=Date+.3),alpha=.1)+
#   geom_point(aes(x=Date,y=N1,color=Filter))+scale_y_log10()+facet_wrap(~Site)
LatWasteDF%>%
select(Date,Site,N1)%>%
mutate(lower=N1-2*0.2196*N1)%>%
mutate(Upper=N1+2*0.2196*N1)%>%
#mutate(contzero=lower<0&Upper>0)
ggplot()+
geom_rect(aes(ymin=lower,ymax=Upper,xmin=Date-1,xmax=Date+1),fill="red",alpha=.1)+
geom_point(aes(x=Date,y=N1))+facet_wrap(~Site)
LatData=LatWasteDF%>%
filter((Site=="Madison"))%>%
select(Date,Site,N1)%>%
mutate(lower=N1-2*0.2199*N1)%>%
mutate(Upper=N1+2*0.2199*N1)
HFGData=HFGFrame%>%
filter((Site=="Madison"))
#??lat data off shifted by one day??
N1Start=min(HFGFrame$Date)
N1End=max(HFGFrame$Date)
ggplot()+
geom_rect(aes(ymin=lower,ymax=Upper,xmin=Date-1.3,xmax=Date-.7),fill="red",alpha=.1,data=LatData)+
geom_point(aes(y=N1,color=Filter,x=Date,shape="High Frequency"),data=HFGData)+
geom_point(aes(y=N1,x=Date-1,shape="Longitudinal"),data=LatData,size=2.5)+
scale_y_log10()+
scale_x_date(limits=c(N1Start,N1End))+ggtitle("Waste data and predicted 2 standard deviations")
LatData=LatWasteDF%>%
select(Date,Site,N1)%>%
mutate(lower=N1-2*0.2196*N1)%>%
mutate(Upper=N1+2*0.2196*N1)
#??lat data off shifted by one day??
N1Start=min(HFGFrame$Date)
N1End=max(HFGFrame$Date)
ggplot()+
geom_rect(aes(ymin=lower,ymax=Upper,xmin=Date-1,xmax=Date+1),fill="red",alpha=.1,data=LatData)+
geom_point(aes(y=N1,x=Date),data=LatData,size=2.5)+
facet_wrap(~Site)+
scale_y_log10()+
ggtitle("Waste data and predicted 2 standard deviations")
HFGVar
HFGFrame
HFGVar=HFGFrame%>%
select(Date,Site,N1,Pct_BCoV)%>%
filter(N1<10e7)%>%
group_by(Site,Date)%>%
summarize(mN1=mean(N1),vN1=var(N1),VPM=mean(Pct_BCoV))
HFGVar%>%
ggplot()+aes(x=mN1,y=VPM)
HFGVar%>%
ggplot()+aes(x=mN1,y=VPM)+geom_point()
HFGVar%>%
ggplot()+aes(x=mN1,y=VPM)+geom_point()+scale_y_log10()
HFGVar%>%
ggplot()+aes(x=mN1,y=VPM)+geom_point()+scale_x_log10()
HFGVar%>%
ggplot()+aes(x=vN1,y=VPM)+geom_point()+scale_x_log10()
HFGVar=HFGFrame%>%
select(Date,Site,N1,Pct_BCoV)%>%
filter(N1<10e7)%>%
group_by(Site,Date)%>%
summarize(mN1=mean(N1),vN1=var(N1),VBC=mean(Pct_BCoV))
HFGVar%>%
ggplot()+aes(x=vN1,y=VPM)+geom_point()+scale_x_log10()
HFGVar%>%
ggplot()+aes(x=vN1,y=VBC)+geom_point()+scale_x_log10()
p1=LatWasteDF%>%
filter((Site=="UW-Sellery")|(Site=="UW-LakeShore"))%>%
filter(!(Date %in% NovemberBreak))%>%
mutate(Loc="10")%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("1/25/2021"),"4",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("12/18/2020"),"3",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("11/18/2020"),"2",Loc))%>%
mutate(Loc=ifelse(Site=="UW-LakeShore"&Date<mdy("10/18/2020"),"1",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("2/5/2021"),"5",Loc))%>%
#mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("12/18/2020"),"4",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("12/18/2020"),"3",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("11/4/2020"),"2",Loc))%>%
mutate(Loc=ifelse(Site=="UW-Sellery"&Date<mdy("10/11/2020"),"1",Loc))%>%
ggplot()+
geom_boxplot(aes(y=N1,x=Date,group=Loc),fill="light blue",show.legend = FALSE)+
#geom_point(aes(y=N1,x=Date,color=Loc),fill="light blue")+
scale_y_log10()+
facet_wrap(~Site)+
ylab("N1 (GC/L)")+
scale_x_date(limits=c(LeftDate,RightDate))+ Header_theme(ConfigOption)
