---
params:
  BaseDir: "Z:/"
  ##BaseDir: "/Volumes/byandell/"
title: "Overview Of Data"
author: "Marlin"
output: html_document
---


```{r Used in last step, include=FALSE}

source("../../lib/DataProccess.R")
```


```{r Gen need functions}

AVGGenFN <- function(N1, N2) {
  AVG <- sqrt(N1 * N2)
  AVG <- ifelse(is.na(N1), N2, AVG)
  AVG <- ifelse(is.na(N2), N1, AVG)
}
```

Input: `Shareable_Data_cases.csv`
Source: DHS People
Output: DHSCaseData-4_21_2022.csv
Note: 
```{r }
library(tidyverse)
library(lubridate)
BaseDir <- "./../../"
DHSCaseDF <- read.csv("./../../data/source/WastewaterDataWisconsin/Shareable_Data_cases.csv")%>%
  group_by(FirstConfirmedDt, DISPLAY_NA)%>%
  summarize(FirstConfirmed = n())%>%
  rename(Date = FirstConfirmedDt, Site = DISPLAY_NA)%>%
  mutate(Date = mdy(Date),
         Site=ifelse(Site=="Madison MSD WWTF","Madison",Site))

#write.csv(DHSCaseDF,paste0(BaseDir,"data/processed/DHSCaseData-4_21_2022.csv"),row.names=FALSE)

DHSCaseDF <- read.csv(paste0(BaseDir,"data/processed/DHSCaseData-4_21_2022.csv"))%>%
  mutate(Date=as.Date(Date))

```

Input: `Shareable_Data_wastewater.csv`
Source: DHS People
Output: DHSWasteData4_21_2022.csv
Note: workset4.csv is created from the same file in the surveillance branch
```{r }
library(tidyverse)
library(lubridate)
BaseDir <- "./../../"
DHSWasteDF <- read.csv("./../../data/source/WastewaterDataWisconsin/Shareable_Data_wastewater.csv")%>%
    rename(repName="pcr_type",
           Site="wwtp_name",
           Pop = "population_served",
           Date="sample_collect_date",
           N1="n1_sars_cov2_conc",
           N1LOD="n1_sars_cov2_lod",
           N2="n2_sars_cov2_conc",
           N2LOD="n2_sars_cov2_lod",
           PMMoV = "ppmov_conc",
           FlowRate = "average_flow_rate")%>%
  mutate(Date = mdy(Date),
         #Standardizing the Site names names
      Site=ifelse(Site=="Madison MSD WWTF","Madison",Site),
      Site=ifelse(Site=="Madison-P2-Central","MMSD-P2",Site),
      Site=ifelse(Site=="Madison-P7-SE","MMSD-P7",Site),
      Site=ifelse(Site=="Madison-P8-West","MMSD-P8",Site),
      Site=ifelse(Site=="Madison-P11-SW","MMSD-P11",Site),
      Site=ifelse(Site=="Madison-P18-NE","MMSD-P18",Site),
      across(all_of(c("N1","N2","PMMoV","Pop","FlowRate")),as.numeric),
      across(all_of(c("N1LOD","N2LOD")),~tolower(str_trim(.x))),
      across(all_of(c("N1LOD","N2LOD")),~ifelse(.x=="yes",TRUE,ifelse(.x=="no",FALSE,NA))))
  

#write.csv(DHSWasteDF,paste0(BaseDir,"data/processed/DHSWasteData-4_21_2022.csv"),row.names=FALSE)

DHSWasteDF <- read.csv(paste0(BaseDir,"data/processed/DHSWasteData-4_21_2022.csv"))%>%
  mutate(Date=as.Date(Date))

```


Input: `HFG data for stats corrected 071421.xlsx`
Source: Dagmara email Wed 7/14/2021 7:31 PM
Output: HFGWasteData071421.csv
Note: 
```{r HFG data for stats corrected 071421}
#needs: readxl, tidyverse, lubridate
library(readxl)
library(tidyverse)
library(lubridate)
BaseDir <- params$BaseDir
HFGWasteFN <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/HFG data for stats corrected 071421.xlsx")


MissingCode <-c("","NA","0","Undetected","Not Detected",
           "Field Parameters to be filled in", 
           "Inhibited-to be re-ran", "#DIV/0!","-","In progress","Undetermined","LA")

HFGWasteDF <- read_excel(HFGWasteFN, na = MissingCode,
                         col_types = c(rep("text", 5), rep("numeric", 2),"text",rep("numeric", 2),"text",rep("numeric", 3)),
                                                 sheet = 1)%>%
    rename(repName="qpCR Sample Name",
           Site="Plant",
           Date="Collection Date",
           N1Ct="N1 CT",
           N1="N1 GC/L",
           N1LOD="N1 <LOD",
           N2Ct="N2 CT",
           N2="N2 GC/L",
           N2LOD="N2 <LOD",
           PMMOVCT="PMMOV CT",
           PMMOV="PMMOV GC/L",
           BCoV="BCoV% recovery",
           Filter = "Filter Rep",
           Well = "Well Rep")%>%
    mutate(N1LOD=N1LOD=="Y",
           N2LOD=N2LOD=="Y",
           AVG = AVGGenFN(N1, N2),
           wt = 2 - is.na(N1) - is.na(N2),
           Date=coalesce(suppressWarnings(as.numeric(Date))-1+ymd("1900-01-01"),
                           suppressWarnings(mdy(Date))))

#write.csv(HFGWasteDF,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGWasteData071421.csv"),row.names=FALSE)

HFGWasteDF <- read.csv(paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGWasteData071421.csv"))%>%
  mutate(Date=as.Date(Date))
```

`

Input: `HFG_data_corrected_w_HF183&CrP_011422.xlsx`
Source: Dagmara email Fri 2/25/2022 6:15 PM
Output: HFGWasteData011422.csv
Note: 
```{r HFG data for HFG_data_corrected_w_HF183&CrP_011422.xlsx}
library(readxl)
HFGCases2FN  <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/HFG_data_corrected_w_HF183&CrP_011422.xlsx")


#-1 = Undeterminded
#-2 = omitted
#-3 = -
HFGWaste <- read_excel(HFGCases2FN,col_types =  "text")%>%
  rename(Site = Plant,
         Date = `Collection Date`,
         Filter = `Filter Rep`,
         Well = `Well Rep`,
         N1Ct =  `N1 CT`,
         N1 = `N1 GC/L`,
         BCoV = `BCoV % Recovery`,
         HF183CT = `HF183 CT`,
         HF183 = `HF183 GC/L`,
         CrPCT = `CrP CT`,
         CrP = `CrP GC/L`,
         N2CT = `N2 CT`,
         N2 = `N2 GC/L`,
         PMMOVCT = `PMMOV CT`,
         PMMOV = `PMMOV GC/L`,
         N1LOD = `N1 <LOD`,
         N2LOD = `N2 <LOD`)%>%
  filter(!is.na(Site))%>%
  mutate(Date = ifelse(is.na(as.integer(Date)), 
                                     mdy(Date),
                                     as.Date(as.integer(Date),
                                             origin = "1899-12-30")))%>%


#write.csv(HFGWaste,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGWasteData011422.csv"),row.names=FALSE)

HFGWasteDF <- read.csv(paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGWasteData011422.csv"))%>%
  mutate(Date=as.Date(Date))

```


Input: `HighFreq_CaseData_2021-05-07.csv`
Source: Steve Wed 5/26/2021 11:25 AM
Output: HFGCaseData_2021-05-07.csv
Note: Steve got the data from Nathan
```{r HighFreq_CaseData_2021-05-07}
HFGCasesFN  <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/HighFreq_CaseData_2021-05-07.csv")


HFGCaseDFNoReported <- read.csv(HFGCasesFN)%>%
  rename(Site=wwtp_name)%>%
  filter(!is.na(Site))%>%
  mutate(Date=ymd(Date))%>%
  mutate(Site=ifelse(Site=="SunPrairie","Sun Prairie",Site))%>%
  mutate(Site=ifelse(Site=="RiverFalls","River Falls",Site))
  
HFGCaseDFReportedOnly <- HFGCaseDFNoReported%>%
  mutate(Date=Date+1,ReportedCases=ConfirmedCases)%>%
  select(Date,Site,ReportedCases)
  
HFGCaseDF  <-  full_join(HFGCaseDFReportedOnly,HFGCaseDFNoReported,by=c("Date","Site"))


#write.csv(HFGCaseDF,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGCaseData_2021-05-07.csv"),row.names=FALSE)

HFGCaseDF <- read.csv(paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/HFGCaseData_2021-05-07.csv"))%>%
  mutate(Date=as.Date(Date))
```



Input: `WATERMICRO_WW_COVID-2022-01-07_F_v1.1.xlsx`
Source: Adelaide Mon 1/10/2022 1:27 PM
Output: LIMSWasteData_01-25-21_01-05-22.csv
Note: 
```{r WATERMICRO_WW_COVID-2022-01-07_F_v1.1}
library(readxl)
LIMSFN <- paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/WATERMICRO_WW_COVID-2022-01-07_F_v1.1.xlsx")

NumericVars=c("average_flow_rate","avg_sars_cov2_conc","bcov_rec_rate",
                "bcov_spike_conc","capacity_mgd","conductivity",
                "equiv_sewage_amt","n1_lod","n1_loq","n1_num_no_target_control",
                "n1_sars_cov2_conc","n1_sars_cov2_error","n1_sars_cov2_lod",
                "n2_lod","n2_loq","n2_num_no_target_control","n2_sars_cov2_conc",
                "n2_sars_cov2_error","ph","pmmov_conc","population_served",
                "temperature","tss")
  
LIMSDF <- read_excel(LIMSFN,na  =  MissingCode,col_types = c(rep("text",58)))
LIMSDF
LIMSDF <- suppressWarnings(mutate(LIMSDF,
      across(all_of(NumericVars),as.numeric),
      test_result_date=as.POSIXlt(test_result_date,format="%m/%d/%Y %H:%M")
    ))%>%
    rename(
      Site = wwtp_name,
      FlowRate = average_flow_rate,
      cov2_conc = avg_sars_cov2_conc,
      BCoV = bcov_rec_rate,
      BCoVConc = bcov_spike_conc,
      county = county_names,
      Date = sample_collect_date,
      RepDate = test_result_date,
      N1 = n1_sars_cov2_conc,
      N1Error = n1_sars_cov2_error,
      N2 = n2_sars_cov2_conc,
      N2Error = n2_sars_cov2_error,
      PMMoV = pmmov_conc,
      Pop = population_served
    )%>%
   mutate(Date = as.Date(ifelse(is.na(as.numeric(Date)),
                             as.Date(strptime(Date,format = "%m/%d/%Y")),
                             as.Date(as.numeric(Date),origin = "1899-12-30")),
                        origin = "1970-01-01"))%>%
    mutate(#Standardizing the Site names names
      Site=ifelse(Site=="Madison Metro","Madison",Site),
      Site=ifelse(Site=="Covid Sewage UW DORM","UW-LakeShore",Site),
      Site=ifelse(Site=="Covid Sewage UW Sell","UW-Sellery",Site),
      Site=ifelse(Site=="Madison-P2-Central","MMSD-P2",Site),
      Site=ifelse(Site=="Madison-P7-SE","MMSD-P7",Site),
      Site=ifelse(Site=="Madison-P8-West","MMSD-P8",Site),
      Site=ifelse(Site=="Madison-P11-SW","MMSD-P11",Site),
      Site=ifelse(Site=="Madison-P18-NE","MMSD-P18",Site),
      AVG = AVGGenFN(N1, N2),
      wt = 2 - is.na(N1) - is.na(N2),
      #Giving the different semesters unique names
      isDorm = ifelse(Site %in% c("UW-LakeShore","UW-Sellery"),TRUE,FALSE),
      Site = ifelse(isDorm&Date>=ymd("2021-01-11"),paste("Spring",Site),Site),
      Site = ifelse(isDorm&Date<=ymd("2020-12-25"),paste("Fall",Site),Site),
      Site = ifelse(isDorm&Date>ymd("2020-12-25")&
                      Date<ymd("2021-01-11"),paste("Break",Site),Site)
    )%>%
    select(-isDorm)%>%
    #converting -1 meaning missing data to NA
    mutate(N1=ifelse(N1==-1,NA,N1),
           N2=ifelse(N2==-1,NA,N2),
           PMMoV=ifelse(PMMoV==-1,NA,PMMoV),
           BCoV=ifelse(BCoV==-1,NA,BCoV))%>%
    mutate(AVG = AVGGenFN(N1, N2),
           wt = 2 - is.na(N1) - is.na(N2))%>%
  select(Site,Date,everything())



LIMSDFParsedFN <- paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/LIMSWasteData_01-25-21_01-05-22.csv")

#write.csv(LIMSDF,LIMSDFParsedFN,row.names=FALSE)

LIMSDF <- read.csv(LIMSDFParsedFN)%>%
  mutate(Date=as.Date(Date))

LIMSDF <- ParseData(LIMSDFParsedFN)

```
Input: `qPCR Semi-Final Query 2.9.22.xlsx`
Source: Dagmara Fri 3/4/2022 7:30 PM
Output: LIMSWasteData_02-09-22.csv
Note: 
```{r qPCR Semi-Final Query 2.9.22}
LIMSFN <- paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/qPCR Semi-Final Query 2.9.22.xlsx")

NumericVars=c("average_flow_rate","avg_sars_cov2_conc","bcov_rec_rate",
                "bcov_spike_conc","capacity_mgd","conductivity",
                "equiv_sewage_amt","n1_lod","n1_loq","n1_num_no_target_control",
                "n1_sars_cov2_conc","n1_sars_cov2_error","n1_sars_cov2_lod",
                "n2_lod","n2_loq","n2_num_no_target_control","n2_sars_cov2_conc",
                "n2_sars_cov2_error","ph","pmmov_conc","population_served",
                "temperature","tss")
  
LIMSDF <- read_excel(LIMSFN,na  =  MissingCode,col_types = c(rep("text",58)))
LIMSDF <- mutate(LIMSDF,
      across(all_of(NumericVars),as.numeric),
      test_result_date=as.POSIXlt(test_result_date,format="%m/%d/%Y %H:%M"))%>%
    rename(
      Site = wwtp_name,
      FlowRate = average_flow_rate,
      cov2_conc = avg_sars_cov2_conc,
      BCoV = bcov_rec_rate,
      BCoVConc = bcov_spike_conc,
      county = county_names,
      Date = sample_collect_date,
      RepDate = test_result_date,
      N1 = n1_sars_cov2_conc,
      N1Error = n1_sars_cov2_error,
      N2 = n2_sars_cov2_conc,
      N2Error = n2_sars_cov2_error,
      PMMoV = pmmov_conc,
      Pop = population_served
    )%>%
  mutate(Date = as.Date(ifelse(is.na(as.numeric(Date)),
                             as.Date(strptime(Date,format = "%m/%d/%Y")),
                             as.Date(as.numeric(Date),origin = "1899-12-30")),
                        origin = "1970-01-01"))%>%
    mutate(#Standardizing the Site names names
      Site=ifelse(Site=="Madison Metro","Madison",Site),
      Site=ifelse(Site=="Covid Sewage UW DORM","UW-LakeShore",Site),
      Site=ifelse(Site=="Covid Sewage UW Sell","UW-Sellery",Site),
      Site=ifelse(Site=="Madison-P2-Central","MMSD-P2",Site),
      Site=ifelse(Site=="Madison-P7-SE","MMSD-P7",Site),
      Site=ifelse(Site=="Madison-P8-West","MMSD-P8",Site),
      Site=ifelse(Site=="Madison-P11-SW","MMSD-P11",Site),
      Site=ifelse(Site=="Madison-P18-NE","MMSD-P18",Site),
      AVG = AVGGenFN(N1, N2),
      wt = 2 - is.na(N1) - is.na(N2),
      #Giving the different semesters unique names
      isDorm = ifelse(Site %in% c("UW-LakeShore","UW-Sellery"),TRUE,FALSE),
      Site = ifelse(isDorm&Date>=ymd("2021-01-11"),paste("Spring",Site),Site),
      Site = ifelse(isDorm&Date<=ymd("2020-12-25"),paste("Fall",Site),Site),
      Site = ifelse(isDorm&Date>ymd("2020-12-25")&
                      Date<ymd("2021-01-11"),paste("Break",Site),Site)
    )%>%
    select(-isDorm)%>%
    #converting -1 meaning missing data to NA
    mutate(N1=ifelse(N1==-1,NA,N1),
           N2=ifelse(N2==-1,NA,N2),
           PMMoV=ifelse(PMMoV==-1,NA,PMMoV),
           BCoV=ifelse(BCoV==-1,NA,BCoV))%>%
    mutate(AVG = AVGGenFN(N1, N2),
           wt = 2 - is.na(N1) - is.na(N2))%>%
  select(Site,Date,everything())



LIMSDFParsedFN <- paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/LIMSWasteData_02-09-22.csv")

write.csv(LIMSDF,LIMSDFParsedFN,row.names=FALSE)

LIMSDF2 <- read.csv(LIMSDFParsedFN)%>%
  mutate(Date=as.Date(Date))

LIMSDF <- ParseData(LIMSDFParsedFN)
```










































Input: `qPCR Semi-Final Query 2.9.22.xlsx`
Source: Not sure
Output: MMSD_Cases_2022_01_12_processed.csv
Note: 
```{r MSD_Cases_2022_01_12}
LIMSCaseMMSDFN  <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/MMSD_Cases_2022_01_12.csv")
LIMSSpringDormFN  <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/SpringSemester_CasesByDorm.TSV")
LIMSFallDormFN  <-  paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/raw/FallSemester_CasesByDorm.TSV")

SpringDorms <- read.csv(LIMSSpringDormFN,sep = "",header = T)%>%
    mutate(Tests=Negative	+ Positive,Per_pos=100*Positive/Tests,
           Site = ifelse(Site == "UW_D", "UW-LakeShore", Site),
           Site = ifelse(Site == "UW_S", "UW-Sellery", Site),
           Date=mdy(Date),
           Site = ifelse(Date>=ymd("2021-01-11"),paste("Spring",Site),Site),
           Site = ifelse(Date<=ymd("2020-12-25"),paste("Fall",Site),Site),
           Site = ifelse(Date>ymd("2020-12-25")&
                           Date<ymd("2021-01-11"),paste("Break",Site),Site))%>%
    rename(Cases=Positive)%>%
    select(-Negative)%>%
    mutate(Population=NA)
FallDorms <- read.csv(LIMSFallDormFN,sep = "",header = T)%>%
    mutate(Tests=Negative	+ Positive,Per_pos=100*Positive/Tests,
           Site = ifelse(Site == "UW_D", "UW-LakeShore", Site),
           Site = ifelse(Site == "UW_S", "UW-Sellery", Site),
           Date=mdy(Date),
           Site = ifelse(Date>=ymd("2021-01-11"),paste("Spring",Site),Site),
           Site = ifelse(Date<=ymd("2020-12-25"),paste("Fall",Site),Site),
           Site = ifelse(Date>ymd("2020-12-25")&
                           Date<ymd("2021-01-11"),paste("Break",Site),Site))%>%
    rename(Cases=Positive)%>%
    select(-Negative)%>%
    mutate(Population=NA)

lag=1
MMSDdata  <-  read.csv(LIMSCaseMMSDFN)%>%
  rename(Site=ServiceID)%>%
  mutate(Site = ifelse(Site=="MMSD","Madison",paste("MMSD-P",Site,sep="")),
  Date = as.Date(Date))%>%
  group_by(Site)%>%
  mutate(Cases=Cases - lag(Cases, n=lag,default = NA),
    Tests=Tests- lag(Tests, n=lag,default = NA))%>%
  mutate(Per_pos=100*Cases/Tests)%>%
  mutate(Site = ifelse(Site == "MMSD P18", "MMSD-P18", Site),
          Site = ifelse(Site == "MMSD P11", "MMSD-P11", Site),
          Site = ifelse(Site == "MMSD P2", "MMSD-P2", Site),
          Site = ifelse(Site == "MMSD P7", "MMSD-P7", Site),
          Site = ifelse(Site == "MMSD P8", "MMSD-P8", Site))


MadisonCaseDF <- rbind(rbind(MMSDdata,SpringDorms,FallDorms))


#write.csv(MadisonCaseDF,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/MMSD_Cases_2022_01_12_processed.csv"),row.names=FALSE)

MadisonCaseDF <- read.csv(paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/MMSD_Cases_processed.csv"))%>%
  mutate(Date=as.Date(Date))
```



Input: `HFG_data_corrected_w_HF183&CrP_F.csv`
Source: Dagmara Fri, 19 Nov 2021 01:16:29
Output: UpdatedHFGFN.csv
Note: 
```{r HFG Updated Data}

MissingCode <-c("","NA","0","Undetected","Not Detected",
           "Field Parameters to be filled in", 
           "Inhibited-to be re-ran", "#DIV/0!","-","In progress","Undetermined",
           "LA","omitted")

UpdatedHFGFN <- "HFG_data_corrected_w_HF183&CrP_F.csv"
UpdatedHFGDF <- read.csv(UpdatedHFGFN,na.strings=MissingCode)%>%
  rename(Site = Plant,
         Date = Collection.Date,
         Filter = Filter.Rep,
         Well = Well.Rep,
         N1Ct =  N1.CT,
         N1 = N1.GC.L,
         BCoV = BCoV...Recovery,
         HF183CT = HF183.CT,
         HF183 = HF183.GC.L,
         CrPCT = CrP.CT,
         CrP = CrP.GC.L,
         N2CT = N2.CT,
         N2 = N2.GC.L,
         PMMOVCT = PMMOV.CT,
         PMMOV = PMMOV.GC.L,
         N1LOD = N1..LOD,
         N2LOD = N2..LOD)%>%
  #filter(!is.na(Filter))%>%
  mutate(Date = ifelse(Date<as.Date("2020-1-1"),Date+ years(2000),Date),
         N1 = as.numeric(gsub(",", "", N1)),
         N2 = as.numeric(gsub(",", "", N2)),
         PMMOV = as.numeric(gsub(",", "", PMMOV)),
         CrP = as.numeric(gsub(",", "", CrP)),
         HF183 = as.numeric(gsub(",", "", HF183)),
         Date = as.Date(Date,format="%m/%d/%Y"))


#write.csv(UpdatedHFGDF,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/UpdatedHFGFN.csv"),row.names=FALSE)

UpdatedHFGDF <- read.csv(paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/UpdatedHFGFN.csv"))%>%
  mutate(Date=as.Date(Date),N1 = as.numeric(N1),N1Ct = as.numeric(N1Ct))
HFGWasteDF

HFGDataDiff <- full_join(UpdatedHFGDF,HFGWasteDF)

```





Input: `MSN_Interceptor_Cases.csv`
Source: Nathan Fri 2/4/2022 4:32 PM
Output: MMSD_Interceptor_Cases_2_7_22.csv
Note: 
```{r MSN_Interceptor_Cases 2/7/22}
MadisonCaseFN  <-  paste0(BaseDir, "COVID-19_WastewaterAnalysis/data/raw/MSN_Interceptor_Cases.csv")
DF <- read.csv(MadisonCaseFN)%>%
  rename(Site = INFLUENT_F)%>%
  mutate(Site = ifelse(Site == "18", "MMSD-P18", Site),
          Site = ifelse(Site == "11", "MMSD-P11", Site),
          Site = ifelse(Site == "2", "MMSD-P2", Site),
          Site = ifelse(Site == "7", "MMSD-P7", Site),
          Site = ifelse(Site == "8", "MMSD-P8", Site),
          EpisodeDate = mdy(EpisodeDate),
          SpecCollectedDate = mdy(SpecCollectedDate),
          FirstConfirmedDt = mdy(FirstConfirmedDt))
  
EDate <- DF%>%
  group_by(EpisodeDate,Site)%>%
  summarise(EpisodeCase = n())%>%
  rename(Date = EpisodeDate)
SpecDate <- DF%>%
  group_by(SpecCollectedDate,Site)%>%
  summarise(SpecCollectedCase = n())%>%
  rename(Date = SpecCollectedDate)
ConDate <- DF%>%
  group_by(FirstConfirmedDt,Site)%>%
  summarise(FirstConfirmed = n())%>%
  rename(Date = FirstConfirmedDt)

CaseDF <- full_join(EDate,full_join(SpecDate,ConDate, by = c("Date","Site")), by = c("Date","Site"))

MadDF <- CaseDF%>%
  group_by(Date)%>%
  summarise(EpisodeCase = sum(EpisodeCase,is.na=TRUE),
            SpecCollectedCase = sum(SpecCollectedCase,is.na=TRUE),
            FirstConfirmed = sum(FirstConfirmed,is.na=TRUE))%>%
  mutate(Site="Madison")
CaseDF <- rbind(CaseDF,MadDF)


#write.csv(CaseDF,paste0(BaseDir,"COVID-19_WastewaterAnalysis/data/processed/MMSD_Interceptor_Cases_2_7_22.csv"),row.names=FALSE)
```
