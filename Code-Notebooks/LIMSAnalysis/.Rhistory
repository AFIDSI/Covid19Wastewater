#+.2
#Different distribution imply measuring different things
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)+.2),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+.2),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+.5),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+3),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+2),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+2.5),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.3+2.8),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.2+2.8),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+2.8),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+2.3),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+2.1),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+2),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+1.5),fill="red",alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+1.2),fill="red",alpha=.5)
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2)/1.1+1.2,paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)/1.1+1.2),fill="red",alpha=.5)
.
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2)/1.1+1.2,paired=FALSE)
t.test(log(MadLIMS$ResidN1),log(MadLIMS$ResidN2),paired=TRUE)
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=ResidN1,color="N1"))+
geom_point(aes(y=ResidN2,color="N2"))+
ggtitle("Residual plot")
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=ResidN1-ResidN2))+
ggtitle("Dif of residuals")
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=N1-N2))
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=log(N1)-log(N2)))
#Measuring different signals
#Similar errors
LIMSNoNullDF%>%
select(N1,N1Error,N2,N2Error)%>%
filter(N1Error>=0)%>%
mutate(AVGError=CombinedSE(N1,N2,N1Error,N2Error))%>%
ggplot()+
geom_point(aes(x=N1,y=N2/N1,color=log(AVGError)),cex=.1)+
#scale_y_log10()+
scale_x_log10()
LIMSNoNullDF%>%
ggplot()+
aes(x=N2/N1)+
geom_histogram()+
scale_x_log10()
LIMSNoNullDF%>%
summarize(MeanRatio=mean(N2/N1,na.rm=TRUE),meadianRatio=median(N2/N1,na.rm=TRUE))
LIMSNoNullDF%>%
mutate(Ratio=N2/N1)%>%
filter(Ratio<2)%>%
ggplot()+
geom_point(aes(x=N1,y=Ratio),cex=.1)+
#scale_y_log10()+
scale_x_log10()
2924/3483
#NH: N1 and N2 draw from same sample
#Alt Hypothesis: They draw from different samples
LIMSNoNullDF%>%
ggplot()+
aes(x=log(N1)-log(N2))+
geom_histogram()+
scale_x_log10()
LIMSNoNullDF%>%
filter(!is.na(N1),!is.na(N2))%>%
mutate(Ratio=N2/N1)%>%
summarise(meanRat=mean(Ratio),ratMean=mean(N2)/mean(N1))
LIMSNoNullDF%>%
ggplot()+
aes(x=N1,y=N2)+
geom_point()+
geom_smooth(method="lm")+
scale_y_log10()+
scale_x_log10()
N1N2LM=lm(log(N2)~log(N1),data=LIMSNoNullDF)
LIMSNoNullDF%>%
mutate(Resid=resid(N1N2LM))%>%
ggplot()+
aes(x=log(N2),y=Resid)+
geom_point()
LIMSNoNullDF%>%
mutate(Resid=resid(N1N2LM))%>%
ggplot()+
aes(x=log(N1),y=Resid)+
geom_point()
summary(N1N2LM)
LIMSNoNullDF%>%
select(N1,N2,N1Error)%>%
mutate(WithinError=abs(N1-N2)<2*N1Error*sqrt(3))%>%
summarise(mean(WithinError))
LIMSNoNullDF%>%
select(N1,N2,N2Error)%>%
mutate(WithinError=abs(N1-N2)<2*N2Error*sqrt(3))%>%
summarise(mean(WithinError))
#Paired T test
#both samples need to be normal
LIMSNoNullDF%>%
ggplot()+
aes(x=log(N1))+
geom_histogram()
LIMSNoNullDF%>%
ggplot()+
aes(x=log(N2))+
geom_histogram()
MadLIMS <- LIMSFullDF%>%
filter(Site=="Madison")%>%
filter(N1>0)%>%
filter(N2>0)%>%
filter(Date>mdy("1/1/2021"))%>%
mutate(Date=as.numeric(Date))
N1Mod <- loess(log(N1)~Date,span=.2,data=MadLIMS)
N2Mod <- loess(log(N2)~Date,span=.2,data=MadLIMS)
MadLIMS$ResidN1 <- resid(N1Mod)
MadLIMS$ResidN2 <- resid(N2Mod)
MadLIMS <- MadLIMS%>%
mutate(Date=as.Date(Date,origin="1970-01-01"))
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1)),color="blue")+
geom_line(aes(y=log(N1)-ResidN1),color="blue")+
#geom_point(aes(y=log(N2)),color="red")+
geom_line(aes(y=log(N2)-ResidN2),color="red")+
facet_wrap(~Site)+
ylab("Smoothed log concentration")
CasePlotMaking("Madison")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
CasePlotMaking("Madison",Method="Per_pos")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2),paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)),fill="red",alpha=.5)
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
LIMSNoNullDF <- LIMSFullDF%>%
filter(Date>mdy("1/1/2021"))%>%
filter(!is.na(N1),!is.na(N2))
MadLIMS <- LIMSNoNullDF%>%
filter(Site=="Madison")%>%
filter(N1>0)%>%
filter(N2>0)%>%
mutate(Date=as.numeric(Date))
N1Mod <- loess(log(N1)~Date,span=.2,data=MadLIMS)
N2Mod <- loess(log(N2)~Date,span=.2,data=MadLIMS)
MadLIMS$ResidN1 <- resid(N1Mod)
MadLIMS$ResidN2 <- resid(N2Mod)
MadLIMS <- MadLIMS%>%
mutate(Date=as.Date(Date,origin="1970-01-01"))
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1)),color="blue")+
geom_line(aes(y=log(N1)-ResidN1),color="blue")+
#geom_point(aes(y=log(N2)),color="red")+
geom_line(aes(y=log(N2)-ResidN2),color="red")+
facet_wrap(~Site)+
ylab("Smoothed log concentration")
CasePlotMaking("Madison")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
CasePlotMaking("Madison",Method="Per_pos")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2),paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1)))+
geom_histogram(aes(x=log(N2)),fill="red",alpha=.5)
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
t.test(log(MadLIMS$ResidN1),log(MadLIMS$ResidN2),paired=TRUE)
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=ResidN1,color="N1"))+
geom_point(aes(y=ResidN2,color="N2"))+
ggtitle("Residual plot")
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=ResidN1-ResidN2))+
ggtitle("Dif of residuals")
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=N1-N2))
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=log(N1)-log(N2)))
#Measuring different signals
#Similar errors
MadSites <- c("Madison","MMSD-P2","MMSD-P7","MMSD-P8","MMSD-P11","MMSD-P18")
LIMSMADDF <- LIMSFullDF%>%
filter(Site %in% MadSites)
LatMadCaseDF <- LatCaseDF%>%
filter(Site %in% MadSites)
RollLatMadCaseDF <- LatCaseDFRoll%>%
filter(Site %in% MadSites)
PlotListN1 <- LIMSMADDF%>%
ggplot()+
aes(x=Date,y=N1)+
geom_point()+
geom_smooth(se=FALSE)+
facet_wrap(~Site)+
scale_y_log10()+
scale_x_date(limits=c(mdy("1/1/2021"),mdy("7/1/2021")))
PlotListCases <- LatMadCaseDF%>%
ggplot()+
geom_rect(aes(ymin=0,ymax=Cases,xmin=Date-.5,
xmax=Date+.5),
alpha=.4,
size=5,na.rm=TRUE)+
facet_wrap(~Site)+
scale_x_date(limits=c(mdy("1/1/2021"),mdy("7/1/2021")))+
coord_cartesian(ylim=c(0,100))+
geom_line(aes(x=Date,y=Cases),color="red",data=RollLatMadCaseDF)
PlotListPer <- LatMadCaseDF%>%
ggplot()+
geom_rect(aes(ymin=0,ymax=Per_pos,xmin=Date-.5,
xmax=Date+.5),
alpha=.4,
size=5,na.rm=TRUE)+
facet_wrap(~Site)+
scale_x_date(limits=c(mdy("1/1/2021"),mdy("7/1/2021")))+
coord_cartesian(ylim=c(0,50))+
geom_line(aes(x=Date,y=Per_pos),color="red",data=RollLatMadCaseDF)
PlotListN1
PlotListCases
PlotListPer
MadLIMS
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1),color="N1"))+
geom_line(aes(y=log(N1)-ResidN1,color="N1"))+
#geom_point(aes(y=log(N2),color="N2"))+
geom_line(aes(y=log(N2)-ResidN2,color="N2"))+
#geom_point(aes(y=log(AVG),color="AVG"))+
geom_line(aes(y=log(AVG)-ResidAVG,color="AVG"))+
facet_wrap(~Site)+
ylab("Smoothed log concentration")
LIMSNoNullDF <- LIMSFullDF%>%
#filter(Date>mdy("1/1/2021"))%>%
filter(!is.na(N1),!is.na(N2))
MadLIMS <- LIMSNoNullDF%>%
filter(Site=="Madison")%>%
filter(N1>0)%>%
filter(N2>0)%>%
mutate(Date=as.numeric(Date))
N1Mod <- loess(log(N1)~Date,span=.2,data=MadLIMS)
N2Mod <- loess(log(N2)~Date,span=.2,data=MadLIMS)
AVGMod <- loess(log(AVG)~Date,span=.2,data=MadLIMS)
MadLIMS$ResidN1 <- resid(N1Mod)
MadLIMS$ResidN2 <- resid(N2Mod)
MadLIMS$ResidAVG <- resid(AVGMod)
MadLIMS <- MadLIMS%>%
mutate(Date=as.Date(Date,origin="1970-01-01"))
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1),color="N1"))+
geom_line(aes(y=log(N1)-ResidN1,color="N1"))+
#geom_point(aes(y=log(N2),color="N2"))+
geom_line(aes(y=log(N2)-ResidN2,color="N2"))+
#geom_point(aes(y=log(AVG),color="AVG"))+
geom_line(aes(y=log(AVG)-ResidAVG,color="AVG"))+
facet_wrap(~Site)+
ylab("Smoothed log concentration")
CasePlotMaking("Madison")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
CasePlotMaking("Madison",Method="Per_pos")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
LIMSNoNullDF <- LIMSFullDF%>%
#filter(Date>mdy("1/1/2021"))%>%
filter(!is.na(N1),!is.na(N2))
MadLIMS <- LIMSNoNullDF%>%
filter(Site=="Madison")%>%
filter(N1>0)%>%
filter(N2>0)%>%
mutate(Date=as.numeric(Date))
N1Mod <- loess(log(N1)~Date,span=.2,data=MadLIMS)
N2Mod <- loess(log(N2)~Date,span=.2,data=MadLIMS)
AVGMod <- loess(log(AVG)~Date,span=.2,data=MadLIMS)
MadLIMS$ResidN1 <- resid(N1Mod)
MadLIMS$ResidN2 <- resid(N2Mod)
MadLIMS$ResidAVG <- resid(AVGMod)
MadLIMS <- MadLIMS%>%
mutate(Date=as.Date(Date,origin="1970-01-01"))
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1),color="N1"))+
geom_line(aes(y=log(N1)-ResidN1,color="N1"))+
#geom_point(aes(y=log(N2),color="N2"))+
geom_line(aes(y=log(N2)-ResidN2,color="N2"))+
#geom_point(aes(y=log(AVG),color="AVG"))+
#geom_line(aes(y=log(AVG)-ResidAVG,color="AVG"))+
facet_wrap(~Site)+
ylab("Smoothed log concentration")+
theme(legend.position="bottom")
CasePlotMaking("Madison")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
CasePlotMaking("Madison",Method="Per_pos")+
theme(axis.text.x = element_text(angle=0, hjust = 0,size=10))+                          scale_x_date(date_labels = "%b")+
theme_grey()
MadLIMS%>%
ggplot()+
aes(x=Date)+
geom_point(aes(y=log(N1),color="N1"))+
geom_line(aes(y=log(N1)-ResidN1,color="N1"))+
geom_point(aes(y=log(N2),color="N2"))+
geom_line(aes(y=log(N2)-ResidN2,color="N2"))+
#geom_point(aes(y=log(AVG),color="AVG"))+
#geom_line(aes(y=log(AVG)-ResidAVG,color="AVG"))+
facet_wrap(~Site)+
ylab("Smoothed log concentration")+
theme(legend.position="bottom")
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1),fill="N1"))+
geom_histogram(aes(x=log(N2),fill="N2"),alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_histogram(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2),fill="N2"),alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2),fill="N2"),alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2)+.2,fill="N2"),alpha=.5)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2),fill="N2"),alpha=.5)
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
#todo: gen number and smooth plot
var(log(LIMSNoNullDF$N1))
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
#todo: gen number and smooth plot
var(log(LIMSNoNullDF$N2))
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2),paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2),fill="N2"),alpha=.5)
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
#todo: gen number and smooth plot
var(log(LIMSNoNullDF$N2))
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2),paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2),fill="N2"),alpha=.5)
#+.2
#/1.1+1.2
#Different distribution imply measuring different things
#todo: gen number and smooth plot
var(log(LIMSNoNullDF$N2))
var(log(LIMSNoNullDF$N1))
mean(log(LIMSNoNullDF$N2))
mean(log(LIMSNoNullDF$N1))
mean(log(LIMSNoNullDF$N2))-mean(log(LIMSNoNullDF$N1))
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2) + 0.2730466,paired=TRUE)
mean(log(LIMSNoNullDF$N2))-mean(log(LIMSNoNullDF$N1))
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2) + 0.2730466,paired=TRUE)
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2) ,paired=TRUE)
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2) + 0.2730466 ,paired=TRUE)
t.test(log(LIMSNoNullDF$N1),log(LIMSNoNullDF$N2)  ,paired=TRUE)
LIMSNoNullDF%>%
ggplot()+
geom_density(aes(x=log(N1),fill="N1"))+
geom_density(aes(x=log(N2)+ 0.2730466,fill="N2"),alpha=.5)
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=abs(ResidN1)-abs(ResidN2)))+
ggtitle("Dif of residuals")
t.test(log(MadLIMS$ResidN1),log(MadLIMS$ResidN2),paired=TRUE)
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=ResidN1,color="N1"))+
geom_point(aes(y=ResidN2,color="N2"))+
ggtitle("Residual plot")
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=abs(ResidN1)-abs(ResidN2)))+
ggtitle("Dif of residuals")
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=N1-N2))
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=log(N1)-log(N2)))
#Measuring different signals
#Similar errors
MadLIMS%>%
ggplot()+
aes(x=Date)+
#geom_point(aes(y=log(N1),color="N1"))+
geom_line(aes(y=log(N1)-ResidN1,color="N1"))+
#geom_point(aes(y=log(N2),color="N2"))+
geom_line(aes(y=log(N2)-ResidN2,color="N2"))+
#geom_point(aes(y=log(AVG),color="AVG"))+
#geom_line(aes(y=log(AVG)-ResidAVG,color="AVG"))+
facet_wrap(~Site)+
ylab("Smoothed log concentration")+
theme(legend.position="bottom")
t.test(log(MadLIMS$ResidN1),log(MadLIMS$ResidN2),paired=TRUE)
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=abs(ResidN1),color="N1"))+
geom_point(aes(y=abs(ResidN2),color="N2"))+
ggtitle("Residual plot")
MadLIMS%>%
ggplot(aes(x=Date))+
geom_point(aes(y=abs(ResidN1)-abs(ResidN2)))+
ggtitle("Dif of residuals")
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=N1-N2))
# MadLIMS%>%
#   ggplot()+
#   aes(x=Date)+
#   geom_point(aes(y=log(N1)-log(N2)))
#Measuring different signals
#Similar errors
#Data before jan is messy-after more clear
#N1 vs N2 is easier after jan
#HFD  using old data
#defer to get the rest of clean data - look at data after jan otherwise
#plots show that data before jan are to messy to analysis
#
#error happens at sampling process
#
#Sickness, Cases, N1
#Sickness -> N1
#Sickness -> tightness ->Cases
#Cases ->smooth -> N1   :Easier to interpret - inferred infected number of people
#N1 -> tightness -> Cases   :harder to mathout - gives same relationship - if I got N1 for last 7 weeks remove old cases concentrations- if was higher recently: expect to grow- use in loess - better smoothing - gen of loess
#4 pm
#get rough idea of where I am going
