---
title: "SE Exploration"
output: html_notebook
---
```{r Prep}
library(shiny)
library(ggpubr)
library(dplyr)
library(shinydashboard)
library(shinyjqui)
library(shinycssloaders)

#Data Files and prep work
source("../../Scripts/GenPlotMaking.R")
source("../../Scripts/WasteWaterDataProccess.R")
source("../../Scripts/CassesDataProccess.R")
source("../../Scripts/HelperFunctions.R")


source("../../Scripts/WasteShiny/PrepData.R", local = TRUE)
```


```{r SE reverse}

#https://math.stackexchange.com/questions/2971315/how-do-i-combine-standard-deviations-of-two-groups
#Correctly Merges two variance into a varience of the two samples
CombinedVar <- function(Mean1,Mean2,Var1,Var2,N1=3,N2=3){
  meanTot <- (N1*Mean1+N2*Mean2)/(N1+N2)
  WeightedVar <- ((N1-1)*Var1 + (N2-1)*Var2)/(N1+N2-1)
  MeanShift <- ((N1*N2)*(Mean1-Mean2)^2)/((N1+N2)*(N1+N2-1))
  return(WeightedVar+MeanShift)
}
#Wraps first function to be useful feeding in infomation in LIMS DF
CombinedSE <- function(Mean1,Mean2,SE1,SE2,N1=3,N2=3){
  Var1 <- SE1^2*N1
  Var2 <- SE2^2*N2
  ComVar <- CombinedVar(Mean1,Mean2,Var1,Var2,N1=N1,N2=N2)
  return(sqrt(ComVar/6))
}

LIMSFullDF%>%
  select(N1,N1Error,N2,N2Error)%>%
  filter(N1Error>=0)%>%
  mutate(AVGError=CombinedSE(N1,N2,N1Error,N2Error))%>%
  ggplot()+
  geom_point(aes(x=N1,y=N2/N1,color=log(AVGError)))+
  scale_y_log10()+
  scale_x_log10()

LIMSFullDF%>%
  ggplot()+
  aes(x=N2/N1)+
  geom_histogram()+
  scale_x_log10()

LIMSFullDF%>%
  summarize(MeanRatio=mean(N2/N1,na.rm=TRUE),meadianRatio=median(N2/N1,na.rm=TRUE))

#NH: N1 and N2 draw from same sample
#Alt Hypothisis: They draw from diffrent samples
```